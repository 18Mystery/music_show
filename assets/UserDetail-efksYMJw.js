import{_ as fe,a as pe,r as m,h as ye,c,d as o,e as y,f as T,C as z,t as _,y as B,A as ke,z as N,q as f,w as U,J as we,g as d,l as j,s as n,b,o as u,F as E,i as R,n as F,B as J,p as Ie,v as Ce,D as be,x as Fe}from"./index-Ci3PLr0-.js";import{_ as Se}from"./backSearch-D-eDlE1G.js";import{_ as xe,a as Ne,b as Le}from"./comcomment-CiR7vvb2.js";import{_ as De}from"./playMy-FspMaofR.js";import{_ as Ue}from"./collect-active-BZg33xkB.js";import{_ as $e}from"./collect-uw9KXPlZ.js";const Te={class:"header"},Ee={class:"user-detail"},Re={class:"user-info-card"},Me={class:"user-info"},Pe={class:"avatar"},Ae=["src"],Ve={class:"details"},ze={class:"name-and-follow"},Be={key:0,class:"extra-info"},Oe={key:0},Ke={key:1},Ge={class:"post-list"},Ye={class:"item"},qe={class:"title"},je={class:"left"},Je={class:"icon"},We=["src"],He={class:"name"},Qe={class:"release-time"},Xe={class:"desc"},Ze={class:"song"},es={class:"photo"},ss=["onClick"],os={key:0,src:De,alt:"播放"},ts={key:1,src:Le,alt:"暂停"},as=["src"],ls={class:"info"},ns={class:"songname"},is={class:"singer"},rs=["onClick"],cs={key:0,src:Ue,alt:"已收藏"},ds={key:1,src:$e,alt:"未收藏"},us={class:"function"},_s=["onClick"],vs={class:"btn"},gs=["onClick"],ms={class:"comment-content"},hs={class:"total-comments"},fs={class:"total-number"},ps={class:"comment-list"},ys=["onClick"],ks={class:"left"},ws=["src","alt"],Is={class:"right"},Cs={class:"name-time"},bs={class:"name"},Fs={key:0,class:"my-comments"},Ss={class:"time"},xs=["onClick"],Ns={class:"user-comment"},Ls={key:0,class:"replies"},Ds={class:"reply-list"},Us=["onClick"],$s=["src"],Ts={class:"reply-content"},Es={class:"name-time"},Rs={class:"name"},Ms={key:0,class:"my-comments"},Ps={class:"time"},As=["onClick"],Vs={class:"user-comment"},zs={key:0,class:"reply-to"},Bs={style:{color:"#707070"}},Os={class:"reply-comment"},Ks=["onClick"],Gs={class:"input-box"},Ys={class:"left-box"},qs=["src"],js={class:"middle-box"},Js=["placeholder"],Ws={__name:"UserDetail",setup(Hs){const M=pe(),v=localStorage.getItem("TOKEN"),p=m([]),k=m(!0),O=m(!0),S=m([]),L=m(!1),w=m(""),g=m(null),W=localStorage.getItem("USERIMG"),$=localStorage.getItem("USER_NAME"),x=localStorage.getItem("USER_ID"),I=m(!1),h=m(null),K=we().params.userId,i=m({}),P=m(!1),H=()=>{setTimeout(()=>{Y(),P.value=!1},1e3)},A=async()=>{try{const e=await d.getUserById({userId:K});i.value=e.data,i.value.avatar_url=d.host+e.data.avatar_url,i.value.birthday=Q(i.value.birthday),console.log("用户详情：",i.value),q()}catch(e){console.error("获取用户信息失败：",e)}};function Q(e){const s=new Date(e);if(isNaN(s.getTime()))throw new Error("输入的日期无效");const a=new Date;if(s>a)throw new Error("输入的日期是未来日期");let l=a.getFullYear()-s.getFullYear();const C=a.getMonth()-s.getMonth();return(C<0||C===0&&a.getDate()<s.getDate())&&l--,l+" 岁"}const X=({position:e},s)=>{switch(console.log("删除当前的社区：",s),e){case"right":return s.user_id==x?new Promise(a=>{Fe({title:"确定删除吗？",confirmButtonColor:"#20a162"}).then(async()=>{try{console.log("开始删除动态...");const l=await d.deleteCommunityDynamics({token:v,postId:s.post_id});console.log("删除动态结果：",l),l.code===200?(console.log("删除成功，刷新动态列表..."),n({type:"success",message:"删除成功"}),getCommunityList(),a(!0)):(n({type:"fail",message:"删除失败"}),console.log(l.err),a(!1))}catch(l){console.error("删除失败:",l),n({type:"fail",message:"删除失败"}),a(!1)}}).catch(()=>{console.log("用户取消了删除操作"),n({type:"fail",message:"用户取消了删除操作"}),a(!1)})}):!1;default:return!1}},Z=async e=>{try{e.isLiked?await d.removeLike({token:v,postId:e.post_id,userId:e.user_id}).then(s=>{console.log("取消点赞成功",s),s.code===200&&(e.isLiked=!1,e.like_count-=1,n("取消点赞成功"))}).catch(s=>{console.error("取消点赞失败:",s),n("取消点赞失败")}):await d.addLike({token:v,postId:e.post_id,userId:e.user_id}).then(s=>{console.log("点赞成功",s),s.code===200&&(e.isLiked=!0,e.like_count+=1,n("点赞成功"))}).catch(s=>{console.error("点赞失败:",s),n("点赞失败")})}catch(s){console.error("点赞操作失败:",s),n("操作失败")}},ee=e=>{console.log("点击父评论回复：",e),I.value=!0,g.value={id:e.id,userId:e.user_id,name:e.user_name},g.value.name===$&&(I.value=!1)},se=e=>{I.value=!0,g.value={id:e.comment_id,userId:e.user_id,name:e.user_name},console.log("点击子评论回复：",g.value),g.value.name===$&&(I.value=!1)},D=async e=>{try{const s=await d.getCommentsWithReplies({token:v,postId:e.post_id});if(s.code===200){S.value=s.data.data;for(const a of S.value)if(a.created_at=V(a.created_at),a.user_avatar=d.host+a.user_avatar,a.postAuthorId=e.user_id,a.replies&&a.replies.length>0)for(const l of a.replies)l.created_at=V(l.created_at),l.user_avatar=d.host+l.user_avatar,l.postAuthorId=e.user_id,l.reply_to=a.user_name;console.log("评论列表：",S.value)}else n({type:"fail",message:"获取评论失败"})}catch(s){console.error("获取评论失败:",s),n({type:"fail",message:"获取评论失败"})}},oe=async e=>{h.value=e,L.value=!L.value,L.value&&(I.value=!1,await D(e))},G=async()=>{if(!w.value.trim()){n({message:"请输入评论内容"});return}try{if(g.value){console.log("回复评论：",g.value);const e=await d.addChildComment({token:v,commentId:g.value.id,userId:x,content:w.value});console.log("添加子评论结果：",e),e.code===200?(await D(h.value),w.value="",I.value=!1,g.value=null):n({type:"fail",message:"添加子评论失败"})}else(await d.addParentComment({token:v,postId:h.value.post_id,userId:x,content:w.value})).code===200?(h.value.comment_count+=1,await D(h.value)):n({type:"fail",message:"添加父评论失败"}),w.value=""}catch(e){console.error("提交评论失败:",e),n({type:"fail",message:"提交评论失败"})}},te=async e=>{try{const s=await d.deleteComment({commentId:e});console.log("删除评论结果：",s),s.code===200?(h.value.comment_count-=1,await D(h.value),n({type:"success",message:"删除评论成功"})):n({type:"fail",message:"删除评论失败"})}catch(s){console.error("删除评论失败:",s),n({type:"fail",message:"删除评论失败"})}},ae=async e=>{try{const s=await d.deleteChildComment({replyId:e});console.log("删除子评论结果：",s),s.code===200?(await D(h.value),n({type:"success",message:"删除子评论成功"})):n({type:"fail",message:"删除子评论失败"})}catch(s){console.error("删除子评论失败:",s),n({type:"fail",message:"删除子评论失败"})}},le=e=>{e.expanded=!e.expanded};function ne(){O.value||console.log("正在加载中...")}const V=e=>{const s=new Date(e),l=(new Date-s)/1e3;return l<60?e="刚刚":l<3600?e=Math.floor(l/60)+"分钟前":l<86400?e=Math.floor(l/3600)+"小时前":l<2592e3?e=Math.floor(l/86400)+"天前":l<31536e3?e=Math.floor(l/2592e3)+"月前":e=Math.floor(l/31536e3)+"年前",e},Y=async()=>{try{const e=await d.getUserDynamics({token:v,userId:K});if(e.code===200){let s=e.result;for(const a of s){const l=a.album_id,C=await j.getAlbumContent(l);a.album_name=C.album.name,a.song_num=C.album.size,a.created_at=V(a.created_at),a.user_avatar=d.host+a.user_avatar,a.isFavorite=!1,a.isPlaying=!1}p.value=s,k.value=!1,console.log("动态列表：",p.value),re(),ie()}}catch(e){console.error("获取动态列表失败：",e)}},ie=async()=>{for(const e of p.value)try{const s=await d.checkLikeStatus({token:v,postId:e.post_id,userId:e.user_id});s.code===200&&(e.isLiked=s.isLiked)}catch(s){console.error("检查点赞状态失败:",s)}console.log("更新点赞状态：",p.value)},q=async()=>{await d.checkFollowUserStatus({token:v,followedId:i.value.user_id}).then(e=>{console.log("关注状态：",e),e.code===200&&(i.value.isFollowing=e.isFollowing)}).catch(e=>{console.error("检查关注状态失败:",e)}),console.log("更新关注状态：",i.value)},re=async()=>{for(const e of p.value)try{const s=await d.checkFavoriteStatus({token:localStorage.getItem("TOKEN"),songId:e.song_id});s.code===200&&(e.isFavorite=s.isFavorite)}catch(s){console.error("检查收藏状态失败:",s)}console.log("更新收藏状态：",p.value)},ce=async e=>{console.log("当前点击的歌曲：",e);try{e.isPlaying=!e.isPlaying,e.isPlaying?(M.addToNextInplayList(e),M.playSong(e),localStorage.setItem("CURRENT_PLAYING_SONG",JSON.stringify({song_id:e.song_id,isPlaying:!0}))):(M.pauseSong(),localStorage.removeItem("CURRENT_PLAYING_SONG")),p.value.forEach(s=>{s.song_id!==e.song_id&&(s.isPlaying=!1)}),console.log("播放状态更新成功：",e)}catch(s){console.error("播放操作失败：",s)}},de=async e=>{console.log("关注用户ID：",e),q(),i.isFollowing?await d.removeFollow({token:v,followedId:e}).then(s=>{console.log("取消关注成功",s),i.isFollowing=!1,n("取消关注"),A()}).catch(s=>{console.error("取消关注失败:",s),n("取消关注失败")}):await d.addFollow({token:v,followedId:e,followedType:"user"}).then(s=>{console.log("关注成功",s),i.isFollowing=!0,n("已关注"),A()}).catch(s=>{console.error("关注失败:",s),n("关注失败")})},ue=async e=>{console.log("params传参：",e);try{if(e.isFavorite)await d.removeFavoriteSong({token:localStorage.getItem("TOKEN"),songId:e.song_id});else{const a=(await j.getSingerDetail(e.artist_id)).artist.img1v1Url,l={token:localStorage.getItem("TOKEN"),songId:e.song_id,songName:e.song_name,artistId:e.artist_id,artistName:e.artist_name,artistImg:a,albumId:e.album_id,albumName:e.album_name,albumImg:e.album_img,songNum:e.song_num};console.log("添加收藏参数：",l),await d.addFavoriteSong(l)}e.isFavorite=!e.isFavorite,n(e.isFavorite?"已收藏":"已取消收藏")}catch(s){console.error("切换收藏状态失败:",s),n("操作失败")}};return ye(()=>{A(),Y()}),(e,s)=>{const a=b("van-skeleton"),l=b("van-icon"),C=b("van-button"),_e=b("van-swipe-cell"),ve=b("van-pull-refresh"),ge=b("van-list"),me=b("van-popup");return u(),c("div",{class:B(["concern",{"color-theme":!k.value}])},[o("div",Te,[o("i",{onClick:s[0]||(s[0]=t=>e.$router.go(-1))},s[6]||(s[6]=[o("img",{src:Se,alt:""},null,-1)])),s[7]||(s[7]=o("div",null,"资料信息",-1))]),o("div",Ee,[y(a,{title:"",avatar:"","avatar-size":"65px",row:1,loading:k.value},null,8,["loading"]),T(o("div",Re,[o("div",Me,[o("div",Pe,[o("img",{src:i.value.avatar_url,alt:""},null,8,Ae)]),o("div",Ve,[o("div",ze,[o("h2",null,_(i.value.user_name),1),T(o("div",{class:B(["concern-btn",{followed:i.value.isFollowing}]),onClick:s[1]||(s[1]=t=>de(i.value.user_id))},[o("i",{style:ke({display:i.value.isFollowing?"none":"block"})},s[8]||(s[8]=[o("img",{src:xe,alt:""},null,-1)]),4),o("span",null,_(i.value.isFollowing?"已关注":"关注"),1)],2),[[z,i.value.user_id!=N(x)]])]),i.value.gender||i.value.birthday?(u(),c("div",Be,[i.value.user_sex?(u(),c("span",Oe,_(i.value.user_sex),1)):f("",!0),i.value.birthday?(u(),c("span",Ke,_(i.value.birthday),1)):f("",!0)])):f("",!0)])])],512),[[z,!k.value]]),s[10]||(s[10]=o("div",{class:"post-title"},[o("span",null,"--- 动态 ---")],-1)),y(ve,{modelValue:P.value,"onUpdate:modelValue":s[2]||(s[2]=t=>P.value=t),"success-text":"刷新成功",onRefresh:H},{default:U(()=>[(u(),c(E,null,R(2,t=>y(a,{title:"",avatar:"",row:4,"title-width":"['60%']","row-width":"['100%', '100%', '100%', '40%']","avatar-size":"45px","avatar-shape":"round",loading:k.value},null,8,["loading"])),64)),o("div",Ge,[(u(!0),c(E,null,R(p.value,t=>(u(),c("div",{class:"list",key:t.post_id},[y(_e,{"before-close":({position:r})=>X({position:r},t)},{right:U(()=>[y(C,{square:"",text:"删除",type:"danger",class:"delete-button"})]),default:U(()=>[o("div",Ye,[o("div",qe,[o("div",je,[o("div",Je,[o("img",{src:t.user_avatar,alt:""},null,8,We)]),o("div",He,_(t.user_name),1),o("div",Qe,_(t.created_at),1)])]),o("div",Xe,_(t.content),1),o("div",Ze,[o("div",es,[o("i",{onClick:F(r=>ce(t),["stop"])},[t.isPlaying?(u(),c("img",ts)):(u(),c("img",os))],8,ss),o("img",{src:t.album_img,alt:""},null,8,as)]),o("div",ls,[o("div",ns,_(t.song_name),1),o("div",is,_(t.artist_name),1)]),o("div",{class:"collect",onClick:F(r=>ue(t),["stop"])},[t.isFavorite?(u(),c("img",cs)):(u(),c("img",ds))],8,rs)]),o("div",us,[o("div",{class:"btn",onClick:r=>Z(t)},[o("i",null,[y(l,{size:"27",name:t.isLiked?"good-job":"good-job-o",color:t.isLiked?"#e5404f":""},null,8,["name","color"])]),o("span",null,_(t.like_count),1)],8,_s),o("div",vs,[o("i",{onClick:r=>oe(t)},s[9]||(s[9]=[o("img",{src:Ne,alt:""},null,-1)]),8,gs),o("span",null,_(t.comment_count),1)])])])]),_:2},1032,["before-close"])]))),128))])]),_:1},8,["modelValue"])]),y(me,{show:L.value,"onUpdate:show":s[5]||(s[5]=t=>L.value=t),round:"",position:"bottom",style:{height:"30%"}},{default:U(()=>[o("div",ms,[o("div",hs,[s[11]||(s[11]=o("span",{class:"comment"},"评论",-1)),o("span",fs,_(h.value.comment_count),1)]),y(ge,{class:B({"no-comment":S.value.length===0}),loading:k.value,"onUpdate:loading":s[3]||(s[3]=t=>k.value=t),finished:O.value,"finished-text":S.value.length===0?"暂无评论~":"没有更多了",onLoad:ne},{default:U(()=>[o("div",ps,[(u(!0),c(E,null,R(S.value,t=>(u(),c("div",{class:"comment-item",onClick:F(r=>ee(t),["stop"]),key:t.id},[o("div",ks,[o("img",{src:t.user_avatar,alt:t.user_avatar},null,8,ws)]),o("div",Is,[o("div",Cs,[o("div",bs,_(t.user_name),1),t.user_id==t.postAuthorId?(u(),c("div",Fs,"作者")):f("",!0),o("div",Ss,_(t.created_at),1),t.user_id==N(x)?(u(),c("i",{key:1,onClick:F(r=>te(t.id),["stop"]),class:"delete-icon"},s[12]||(s[12]=[o("img",{src:J,alt:"删除"},null,-1)]),8,xs)):f("",!0)]),o("div",Ns,_(t.content),1),t.replies&&t.replies.length?(u(),c("div",Ls,[T(o("div",Ds,[(u(!0),c(E,null,R(t.replies,r=>(u(),c("div",{key:r.id,class:"reply-item",onClick:F(he=>se(r),["stop"])},[o("img",{src:r.user_avatar,class:"reply-avatar"},null,8,$s),o("div",Ts,[o("div",Es,[o("div",Rs,_(r.user_name),1),r.user_id==r.postAuthorId?(u(),c("div",Ms,"作者")):f("",!0),o("div",Ps,_(r.created_at),1),r.user_id==N(x)?(u(),c("i",{key:1,onClick:F(he=>ae(r.id),["stop"]),class:"delete-icon"},s[13]||(s[13]=[o("img",{src:J,alt:"删除"},null,-1)]),8,As)):f("",!0)]),o("div",Vs,[r.reply_to&&r.reply_to!=r.user_name?(u(),c("div",zs,[s[14]||(s[14]=Ie("回复 ")),o("span",Bs,_(r.reply_to),1)])):f("",!0),o("div",Os,_(r.content),1)])])],8,Us))),128))],512),[[z,t.expanded]]),o("div",{class:"reply-count",onClick:F(r=>le(t),["stop"])},_(t.expanded?"收起":`展开${t.replies.length}条回复`),9,Ks)])):f("",!0)])],8,ys))),128))])]),_:1},8,["class","loading","finished","finished-text"]),o("div",Gs,[o("div",Ys,[o("img",{src:N(W),alt:"头像"},null,8,qs)]),o("div",js,[T(o("input",{type:"text",placeholder:g.value&&I.value?`${N($)}... 回复 ${g.value.name}`:`${N($)}... 发表评论`,"onUpdate:modelValue":s[4]||(s[4]=t=>w.value=t),onKeyup:be(G,["enter"])},null,40,Js),[[Ce,w.value]])]),o("div",{class:"right-box",onClick:G},s[15]||(s[15]=[o("p",null,"回复",-1)]))])])]),_:1},8,["show"])],2)}}},ao=fe(Ws,[["__scopeId","data-v-0dd4085c"]]);export{ao as default};
