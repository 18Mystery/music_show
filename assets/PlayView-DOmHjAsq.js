import{_ as kt,a as Rt,r,I as N,m as v,h as lt,K as Nt,c as u,d as s,t as c,e as D,w as b,n as F,y as L,z as Y,A as ot,F as Dt,i as bt,p as nt,q as K,B as Vt,s as A,g as V,x as Qt,b as J,o as g,f as Tt,v as Pt,L as Ft,M as Lt,N as Yt,u as Kt}from"./index-Ci3PLr0-.js";import{_ as Jt}from"./collect-active-BZg33xkB.js";const Mt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAICAYAAADwdn+XAAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAAC9SURBVCiRlc7BFcFAFEbh+0YKSAlTQlpICRogwR4VkArCHhGNKEFKmBJSgJmxSDghHPzbme+eJ7qcXhAqM9qn/DhdTBYoGeNsrBBqPIk+TYs/cA6EAAprh0DVRGb5F5y0uMbZ2KTHWpqHJEQNLoAGycx4t+7jJEINzgAtrpoLAJMea5yNAQN+pcvZ+gXrFoc4v7xjAPnwUYNkuOsGggjlC0A3+LDpmqdAP9LZG/w28IhIMEf5CIfB22337O5uHWpXA9s9+LwAAAAASUVORK5CYII=",Ot="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAPCAYAAADphp8SAAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAAD4SURBVDiNpZK9ccJAEIU/SSTOROYQd4CzC3HmDDow7uBRAVCBtwO7A1qQI1+oElQCHciBThojTkKDX3I3t/u+2Z/LmCBJG+fcj3PuwXtfxHLSKSBgDeTAXtLhP6D8zz0KS8bcknJgCXwCi174aGYd8AoUzALeIua+OljWgwg4Aa9ctjOklXMu8d4XXUWh7/0Ec0y7LEC2wMedEIDHdmv3VgJwBt5TSRtuD3VIFfBsZuWMZjsxFUCZJElV1/WB6+FXwIuZVQAzYBUBHM2saB8kLYHtEKQFfdH8m3MA2IR2LiAAqZntgDnwNAL5DmdJM5NqIO+2JC3G4r+VDE9hYg/N/QAAAABJRU5ErkJggg==",zt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAbCAYAAACN1PRVAAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAAEqSURBVEiJ7ZXBWcMwDEafYIFsQDoB5ZYbZQQ26AjaIM0EiAlgBDYoxxzDBmGDbmAOifOlbuOUNjm1/8mxZD/9+WwZbrrpKiWxoKqmQGJm1UheAqQAsdwDWLswB9ZA0gt9AoWZ1UExH8Cql7cD3s1sE4W1i7e+yiOqgVczq1R1DbwFBYW5T2a28xN3QUIeAdHGtqq6oXE0BPK5eX+ic6aqKxpXU2vhf33nTEQeZwAhIs9+3MGcc8s5YM65xQFMRKLH+wJ1+/ad/cwNu/eDsizrLMsSIJsQVJjZl/8Ij35Bcz+mUBVe7D1YewFfJgBW7T57OtobT+gko6B+54jCLgAOgqKwM4BR0CjsH8BR0EmwFuifHQ1Cg8/J2bAeNAWWIvLgnPsFvsfcXIf+AEbubfSDnpAKAAAAAElFTkSuQmCC",Ht="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAPCAYAAAAPr1RWAAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAADGSURBVDiNtZRRDcIwEEBflwnYHAwH4GASwMFQwKFgQQHnABwgAQtImQQ+1ozSdOkllPtr7/Vder3UYQgREeDklwdVfVm4OiPtgRvQBdsPYGPhknIR6TzcJ9KdlXORtAEEGFNFg2gt3CL3/RqBJiMGmCycy1ztp6iZH2hbWgxQ8f3CxeWXf8kdLCP1pPAt4lEcmCcmV+Ro4apwoap3YEemVVbOrSV8q0ZgiFKTqrYWblUeHN4DVz4tUFU9W7icOzzc+w/KzL0BbtE/A1nhATsAAAAASUVORK5CYII=",Wt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAAAXNSR0IArs4c6QAAAKJJREFUSEtjZKADYKSDHQwDa4m5uXkaIyOjJAMDxCGMjIxXjx8/vhrmcwsLCwcGBgYQhoH/J06caMQWMjh9YmFh8R9Nw4ETJ044IlmyH80SBqAlWM0btYTBwsJiNLgQ6Wk0dY1mRlgIjBYruOuT0XxCUj6xtLTs/v//vwmSJlDqgtd8FhYWGQwMDOHwavH//9cnT54MI8kSajYwBrYhQU2fAADzv7MaDWbkIgAAAABJRU5ErkJggg==",Gt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAcCAYAAACUJBTQAAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAAFTSURBVEiJtZbBbYNAEEX/hBTgEighOSDP0e4Ed2BXkNABVBA6SAnhCOLg7cBbAkevEEwOgIQIDhiWf5xF8/b/WS1Lnue9OY7zDQAiEmVZFsKyiJlvANxeTQMI0jSNbULkwVrcwvSWEACAiIREFK2BvUzugugM4IeZ/aWQSScDaQCnNE2TZyCTTgZy0bj6YmZ3K0gnH8CNmT/nfPxsXGPSmDjyNiB92HHsFC6Na0wumgj/zMsmpJMvItf+vLaAgIh2AD72+/0VsDuTUVVV9b6Jk04iUpRlqbeE6Lquj0qp4tV2ZxEpAAT9/5JViIiExphAKVX067YgSVVVlzzP1djiWojGjFt5EURECiKK7vd7OIzGFiQ2xlzmNF8CSdDctsmzu5qEtNFc1rxeHkK63I0xs3L/F9I22w3qCRGdbDyHgMZJDODcNcfC3CfFzAdmPlhv3OoX3PmsAObDG+UAAAAASUVORK5CYII=",Zt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAPCAYAAAAPr1RWAAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAADESURBVDiNtZPdDYIwFEYPhgEcATdwBNwEN/gcwQ3KBOAEuoGM4AYwAhvoAyUpDeINke+t7bmnP+lNJB2BO0NK55xjJlYuTCKpBbJgrgOuzrk6kpu4WP7+slb74s7LTZxVPsYBJdBauHCT3Y8CAAFPKyepGCcsJ1+TDjhZTr4mGVBtJQfItpTf0g2kDcPXbCzyHrgAlYULm2rpWXrgChyWunCJS/3iPipogHPUdVZuIn8AhR+/GK7WzLBWbhpJuaT8X9yYDw4dXWjIxwqdAAAAAElFTkSuQmCC",qt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAAEWSURBVDiN5dIxTsMwGAXg91tFkczIBVg4AAsbiAtwjUiwxEhIXc0I008GkDJ1h4GeoEzdOzEw0I01a4TkxxIqN5KpajZ4m638n54dA/8uEi+cc6eq+jL8yDl3RfIohZDUuq7nADCKhvYBzJxzEwDXqrqMZs5E5CTZSmQGYL7WsAff+2Xbo5pCvuO9N977sMITIAAsARyqarsJjTNK7GvfsAWAqqqeROT4B2esqpMh2AJ4BnA3/DHGmFeSeymN5Mfm7plZ3WFZljtFURzkIF3XvTVN8wlER7bWXgK4yQGttWMAt2sgyakxZpckt8FEREII05wi28d7b347Ez/scwD3mV0uVPUBiO4whLAQkcccjeQis8hfyBfGVmNzPekQfAAAAABJRU5ErkJggg==",Xt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAXCAYAAADgKtSgAAAAAXNSR0IArs4c6QAAAMdJREFUSEvtlcENwjAMRV/n4cYCwAJwgnUo69ATXQBYgBvzQH8VSyUKTSC04lBLlaoofnG+7bhgQCs89hqYZ5x3a/xr8+/CH27xkgFfOt+Wa/AtcARWQC78DOyAyuAlsHDwjMBbV8GvzU/5V3BJV7nv3Q2/jlxJP+jKPdpN8KA4SbIoear/mCnBqmuzJLjAM4+8dwntLt+96kmChyKeqiWYx0E7NFY54z9cmkCnH77nG02kUSaRaRlqnBSdbc9LQ/kD+hNQdO8TyrBUGFgPQxkAAAAASUVORK5CYII=",jt={class:"play"},$t={class:"content"},te={class:"top"},ee={class:"songName"},se={class:"singerName"},ae={class:"middle"},le={class:"pic"},oe=["src"],ne={class:"lyrics"},ie={class:"released"},Ae={class:"published"},re={class:"content"},ue={class:"left"},ce=["src"],ge={class:"right"},de={class:"songTitle"},ve={class:"authorName"},me={class:"playLine"},pe={class:"tabBox"},fe={class:"pattern"},Ie={key:0,src:Jt,style:{width:"48px",height:"48px","margin-top":"-12px","margin-left":"-10px"},alt:""},he={key:1,src:zt,style:{width:"48px",height:"48px","margin-top":"-12px","margin-left":"-10px"},alt:""},Ce={class:"btn"},we={key:0,src:Wt,alt:""},Be={key:1,src:Gt,alt:""},ye={key:1,class:"playList"},Se={class:"topBox"},_e={class:"left"},Ee={class:"num"},xe={class:"content"},Ue=["onClick"],ke=["data-index"],Re={class:"artist"},Ne={class:"right"},De=["onClick"],be={key:0,class:"empty"},Ve={__name:"PlayView",setup(Qe){const it=Kt(),o=Rt(),Q=r(0);let h=null;const y=r(!1),C=r(!1),T=r(-1),w=r(!1),d=r(null),S=r(0),B=r(0),_=r(""),E=r(!1),At=a=>{y.value=!0,O(a)},rt=a=>{y.value&&O(a)},M=()=>{if(y.value){y.value=!1;const a=B.value/S.value*o.duration;o.seek(a)}},O=a=>{if(d.value){const t=d.value.getBoundingClientRect(),l=a.clientX-t.left;B.value=Math.max(0,Math.min(l,S.value))}};N([()=>o.currentTime,()=>o.duration,d],([a,t,l])=>{t>0&&l&&(B.value=a/t*l.offsetWidth)}),N(()=>o.isPlaying,a=>{a?z():H()});const z=()=>{h||(h=setInterval(()=>{Q.value=Q.value+1},20))},H=()=>{h&&(clearInterval(h),h=null)},ut=()=>{E.value=!0},ct=async()=>{const a=localStorage.getItem("TOKEN"),t=e.value.id?e.value.id:e.value.song_id,l=_.value,p=localStorage.getItem("USER_ID"),I={token:a,userId:p,songId:t,text:l};try{(await V.addCommunityDynamics(I)).code===200?(A("发布成功"),E.value=!1,_.value=""):A("发布失败")}catch(f){console.error("发布失败:",f),A("发布失败")}},m=v({get:()=>o.playList,set:a=>o.updatePlayList(a)}),e=v(()=>o.currentSong),x=v(()=>o.currentIndex),P=v(()=>o.currentTime),W=v(()=>o.duration),U=v(()=>o.lyrics),k=v(()=>{const a=P.value;if(Array.isArray(U.value)){for(let t=U.value.length-1;t>=0;t--)if(a>=U.value[t].time)return t}return-1}),gt=v(()=>G(P.value)),dt=v(()=>G(W.value)),vt=()=>{C.value=!0},mt=a=>{a.target.classList.contains("mask")&&(C.value=!1)},pt=()=>{o.togglePlayPause()},ft=()=>{w.value=!0},It=()=>{o.clearPlayList(),C.value=!1,w.value=!1},ht=()=>{console.log("用户取消了清空播放列表的操作"),w.value=!1},Ct=a=>{T.value=a.oldIndex},wt=a=>{T.value=-1,x.value===a.oldIndex&&(o.currentIndex=a.newIndex,console.log("新选中的索引:",a.newIndex)),console.log("拖拽结束，新位置:",a.newIndex)},Bt=a=>{o.removeSongFromPlayList(a)},yt=a=>{a>=0&&a<m.value.length&&o.playSong(m.value[a])},St=async()=>{if(!e.value){A("当前没有正在播放的歌曲");return}try{const a=localStorage.getItem("TOKEN"),t=e.value.id;if(e.value.isFavorite)(await V.removeFavoriteSong({token:a,songId:t})).code===200?(A("已取消收藏"),e.value.isFavorite=!1):A("取消收藏失败");else{const l={token:a,songId:t||(e.value.song_id?e.value.song_id:e.value.id),songName:e.value.name?e.value.name:e.value.title,artistId:e.value.ar?e.value.ar[0].id:e.value.artists[0].id?e.value.artists[0].id:e.value.artist_id,artistName:e.value.ar?e.value.ar[0].name:e.value.artists[0].name?e.value.artists[0].name:e.value.artist_name,artistImg:e.value.ar?e.value.ar[0].img1v1Url:e.value.artists[0].img1v1Url?e.value.artists[0].img1v1Url:e.value.artist_img,albumId:e.value.al?e.value.al.id:e.value.album.id?e.value.album.id:e.value.album_id,albumName:e.value.al?e.value.al.name:e.value.album.name?e.value.album.name:e.value.album_name,albumImg:e.value.al?e.value.al.picUrl:e.value.album.picUrl?e.value.album.picUrl:e.value.album_img,songNum:1};console.log("params的值：",l),(await V.addFavoriteSong(l)).code===200?(A("已收藏"),e.value.isFavorite=!0):A("收藏失败")}}catch(a){console.error("切换收藏状态失败:",a),A("操作失败")}},_t=async()=>{try{console.log("检查当前歌曲的收藏状态:",e.value);const a=localStorage.getItem("TOKEN"),t=e.value.id?e.value.id:e.value.song_id,l=await V.checkFavoriteStatus({token:a,songId:t});l.code===200?e.value.isFavorite=l.isFavorite:(Qt({title:"提示",message:"登录已失效，请重新登录",confirmButtonColor:"#20a162",confirmButtonText:"跳转登录",cancelButtonText:"否"}).then(()=>{it.push("/login")}).catch(()=>{console.log("取消")}),console.log(l))}catch(a){console.error("检查收藏状态失败:",a)}},Et=()=>{x.value>0?o.playPreviousSong():A("没有上一首了")},xt=()=>{x.value<m.value.length-1?o.playNextSong():A("没有下一首了")},G=a=>{let t=Math.floor(a%3600/60),l=Math.floor(a%60);return t=t<10?"0"+t:t,l=l<10?"0"+l:l,`${t}:${l}`};return lt(()=>{d.value&&(S.value=d.value.offsetWidth)}),N([P,W,d],([a,t,l])=>{t>0&&l&&(B.value=a/t*l.offsetWidth)}),N(k,a=>{if(a>=0){const t=document.querySelector(".lyrics ul"),l=t.querySelectorAll("li")[a];if(l){const p=l.offsetHeight,f=l.offsetTop-1*p;t.style.transform=`translateY(-${f}px)`}}}),lt(async()=>{if(d.value&&(S.value=d.value.offsetWidth),k.value>=0){const a=document.querySelector(".lyrics ul"),t=a.querySelectorAll("li")[k.value];if(t){const l=t.offsetHeight,I=t.offsetTop-1*l;a.style.transform=`translateY(-${I}px)`}}e.value&&(console.log("当前播放歌曲的信息:",e.value),await _t()),o.isPlaying&&z()}),Nt(()=>{H()}),(a,t)=>{var f,Z,q,X,j,$,tt;const l=J("van-cell"),p=J("van-popup"),I=J("van-dialog");return g(),u("div",jt,[t[19]||(t[19]=s("div",{class:"bg"},[s("div",{class:"mask"})],-1)),s("div",$t,[s("div",te,[s("i",{onClick:t[0]||(t[0]=n=>a.$router.go(-1))},t[5]||(t[5]=[s("img",{src:Mt,alt:""},null,-1)])),s("p",ee,c(((f=e.value)==null?void 0:f.name)||((Z=e.value)==null?void 0:Z.song_name)),1),s("p",se,c((q=e.value)!=null&&q.ar?e.value.ar[0].name:e.value.artists?e.value.artists[0].name:(X=e.value)==null?void 0:X.artist_name),1),D(l,{onClick:F(ut,["stop"])},{default:b(()=>t[6]||(t[6]=[s("img",{src:Ot,alt:""},null,-1)])),_:1})]),s("div",ae,[s("div",le,[s("img",{class:L(Y(o).isPlaying?"rotation":""),src:(j=e.value)!=null&&j.al?e.value.al.picUrl:($=e.value)==null?void 0:$.album_img,style:ot({transform:`rotate(${Q.value}deg)`}),alt:""},null,14,oe)])]),s("div",ne,[s("ul",null,[(g(!0),u(Dt,null,bt(U.value,(n,i)=>(g(),u("li",{key:i,class:L(i===k.value?"active":"")},c(n.text?n.text:"暂无歌曲"),3))),128))])]),D(p,{show:E.value,"onUpdate:show":t[2]||(t[2]=n=>E.value=n),round:"",position:"bottom",style:{height:"36%"}},{default:b(()=>{var n,i,R,et,st,at;return[s("div",ie,[t[7]||(t[7]=s("p",null,"分享到社区",-1)),s("span",{onClick:F(ct,["stop"])},"发布")]),s("div",Ae,[Tt(s("textarea",{"onUpdate:modelValue":t[1]||(t[1]=Ut=>_.value=Ut),placeholder:"请发表你的想法..."},null,512),[[Pt,_.value]])]),s("div",re,[s("div",ue,[s("img",{src:(n=e.value)!=null&&n.al?e.value.al.picUrl:(i=e.value)==null?void 0:i.album_img,alt:"专辑图片"},null,8,ce)]),s("div",ge,[s("div",de,c(((R=e.value)==null?void 0:R.name)||((et=e.value)==null?void 0:et.song_name)),1),s("div",ve,c((st=e.value)!=null&&st.ar?e.value.ar[0].name:e.value.artists?e.value.artists[0].name:(at=e.value)==null?void 0:at.artist_name),1)])])]}),_:1},8,["show"]),s("div",me,[s("ul",{ref_key:"ul",ref:d,onMousedown:At,onMousemove:rt,onMouseup:M,onMouseleave:M},[s("li",{style:ot(`width: ${B.value}px;`)},null,4)],544),s("p",null,[s("span",null,c(gt.value),1),t[8]||(t[8]=nt("/ ")),s("span",null,c(dt.value),1)])]),s("div",pe,[s("div",fe,[s("i",{onClick:St},[(tt=e.value)!=null&&tt.isFavorite?(g(),u("img",Ie)):(g(),u("img",he))])]),s("div",{class:"pre"},[s("i",{onClick:Et},t[9]||(t[9]=[s("img",{src:Ht,alt:""},null,-1)]))]),s("div",Ce,[s("i",{onClick:pt},[Y(o).isPlaying?(g(),u("img",we)):(g(),u("img",Be))])]),s("div",{class:"next"},[s("i",{onClick:xt},t[10]||(t[10]=[s("img",{src:Zt,alt:""},null,-1)]))]),s("div",{class:"list"},[s("i",{onClick:vt},t[11]||(t[11]=[s("img",{src:qt,alt:""},null,-1)]))])]),C.value?(g(),u("div",{key:0,onClick:mt,class:"mask"})):K("",!0),C.value?(g(),u("div",ye,[s("div",Se,[s("div",_e,[t[12]||(t[12]=s("span",{class:"title"},"当前播放列表",-1)),s("span",Ee,"("+c(m.value.length)+")",1)]),s("div",{class:"right"},[t[14]||(t[14]=s("i",null,[s("img",{style:{width:"17px",height:"17px","margin-top":"3px"},src:Xt,alt:""})],-1)),s("i",{onClick:ft},t[13]||(t[13]=[s("img",{src:Vt,alt:""},null,-1)]))])]),s("div",xe,[D(Y(Yt),{modelValue:m.value,"onUpdate:modelValue":t[3]||(t[3]=n=>m.value=n),itemKey:"id",onStart:Ct,onEnd:wt,animation:200,handle:".drag-handle"},{item:b(({element:n,index:i})=>[s("li",{class:L({"current-song":i===x.value,dragging:i===T.value}),onClick:R=>yt(i)},[s("div",{class:"left","data-index":i},[s("span",null,c(n.name),1),t[15]||(t[15]=nt(" - ")),s("span",Re,c(n.ar?n.ar[0].name:n.artists?n.artists[0].name:"未知歌手"),1)],8,ke),s("div",Ne,[t[17]||(t[17]=s("i",{class:"drag-handle"},[s("img",{style:{width:"17px",height:"17px"},src:Ft,alt:""})],-1)),s("i",{onClick:F(R=>Bt(i),["stop"])},t[16]||(t[16]=[s("img",{style:{width:"16px",height:"12px"},src:Lt,alt:""},null,-1)]),8,De)])],10,Ue)]),footer:b(()=>[m.value.length===0?(g(),u("div",be,t[18]||(t[18]=[s("p",null,"当前播放列表为空",-1)]))):K("",!0)]),_:1},8,["modelValue"])])])):K("",!0),D(I,{show:w.value,"onUpdate:show":t[4]||(t[4]=n=>w.value=n),message:"清空当前播放列表？","show-cancel-button":"","confirm-button-text":"确定","cancel-button-text":"取消",confirmButtonColor:"#20a162",onConfirm:It,onCancel:ht},null,8,["show"])])])}}},Fe=kt(Ve,[["__scopeId","data-v-1364cdc1"]]);export{Fe as default};
