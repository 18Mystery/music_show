import{_ as Nt,a as Dt,r,I as N,m as v,h as it,K as bt,c as u,d as s,A as F,t as c,e as D,w as b,n as L,y as Y,z as K,F as Vt,i as Qt,p as At,q as J,B as Tt,s as A,g as V,x as Pt,b as M,o as g,f as Ft,v as Lt,L as Yt,M as Kt,N as Jt,u as Mt}from"./index-Cshm0C-f.js";import{_ as Ot}from"./collect-active-BZg33xkB.js";const zt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAICAYAAADwdn+XAAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAAC9SURBVCiRlc7BFcFAFEbh+0YKSAlTQlpICRogwR4VkArCHhGNKEFKmBJSgJmxSDghHPzbme+eJ7qcXhAqM9qn/DhdTBYoGeNsrBBqPIk+TYs/cA6EAAprh0DVRGb5F5y0uMbZ2KTHWpqHJEQNLoAGycx4t+7jJEINzgAtrpoLAJMea5yNAQN+pcvZ+gXrFoc4v7xjAPnwUYNkuOsGggjlC0A3+LDpmqdAP9LZG/w28IhIMEf5CIfB22337O5uHWpXA9s9+LwAAAAASUVORK5CYII=",Ht="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAPCAYAAADphp8SAAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAAD4SURBVDiNpZK9ccJAEIU/SSTOROYQd4CzC3HmDDow7uBRAVCBtwO7A1qQI1+oElQCHciBThojTkKDX3I3t/u+2Z/LmCBJG+fcj3PuwXtfxHLSKSBgDeTAXtLhP6D8zz0KS8bcknJgCXwCi174aGYd8AoUzALeIua+OljWgwg4Aa9ctjOklXMu8d4XXUWh7/0Ec0y7LEC2wMedEIDHdmv3VgJwBt5TSRtuD3VIFfBsZuWMZjsxFUCZJElV1/WB6+FXwIuZVQAzYBUBHM2saB8kLYHtEKQFfdH8m3MA2IR2LiAAqZntgDnwNAL5DmdJM5NqIO+2JC3G4r+VDE9hYg/N/QAAAABJRU5ErkJggg==",Wt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAbCAYAAACN1PRVAAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAAEqSURBVEiJ7ZXBWcMwDEafYIFsQDoB5ZYbZQQ26AjaIM0EiAlgBDYoxxzDBmGDbmAOifOlbuOUNjm1/8mxZD/9+WwZbrrpKiWxoKqmQGJm1UheAqQAsdwDWLswB9ZA0gt9AoWZ1UExH8Cql7cD3s1sE4W1i7e+yiOqgVczq1R1DbwFBYW5T2a28xN3QUIeAdHGtqq6oXE0BPK5eX+ic6aqKxpXU2vhf33nTEQeZwAhIs9+3MGcc8s5YM65xQFMRKLH+wJ1+/ad/cwNu/eDsizrLMsSIJsQVJjZl/8Ij35Bcz+mUBVe7D1YewFfJgBW7T57OtobT+gko6B+54jCLgAOgqKwM4BR0CjsH8BR0EmwFuifHQ1Cg8/J2bAeNAWWIvLgnPsFvsfcXIf+AEbubfSDnpAKAAAAAElFTkSuQmCC",Gt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAPCAYAAAAPr1RWAAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAADGSURBVDiNtZRRDcIwEEBflwnYHAwH4GASwMFQwKFgQQHnABwgAQtImQQ+1ozSdOkllPtr7/Vder3UYQgREeDklwdVfVm4OiPtgRvQBdsPYGPhknIR6TzcJ9KdlXORtAEEGFNFg2gt3CL3/RqBJiMGmCycy1ztp6iZH2hbWgxQ8f3CxeWXf8kdLCP1pPAt4lEcmCcmV+Ro4apwoap3YEemVVbOrSV8q0ZgiFKTqrYWblUeHN4DVz4tUFU9W7icOzzc+w/KzL0BbtE/A1nhATsAAAAASUVORK5CYII=",Zt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAAAXNSR0IArs4c6QAAAKJJREFUSEtjZKADYKSDHQwDa4m5uXkaIyOjJAMDxCGMjIxXjx8/vhrmcwsLCwcGBgYQhoH/J06caMQWMjh9YmFh8R9Nw4ETJ044IlmyH80SBqAlWM0btYTBwsJiNLgQ6Wk0dY1mRlgIjBYruOuT0XxCUj6xtLTs/v//vwmSJlDqgtd8FhYWGQwMDOHwavH//9cnT54MI8kSajYwBrYhQU2fAADzv7MaDWbkIgAAAABJRU5ErkJggg==",qt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAcCAYAAACUJBTQAAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAAFTSURBVEiJtZbBbYNAEEX/hBTgEighOSDP0e4Ed2BXkNABVBA6SAnhCOLg7cBbAkevEEwOgIQIDhiWf5xF8/b/WS1Lnue9OY7zDQAiEmVZFsKyiJlvANxeTQMI0jSNbULkwVrcwvSWEACAiIREFK2BvUzugugM4IeZ/aWQSScDaQCnNE2TZyCTTgZy0bj6YmZ3K0gnH8CNmT/nfPxsXGPSmDjyNiB92HHsFC6Na0wumgj/zMsmpJMvItf+vLaAgIh2AD72+/0VsDuTUVVV9b6Jk04iUpRlqbeE6Lquj0qp4tV2ZxEpAAT9/5JViIiExphAKVX067YgSVVVlzzP1djiWojGjFt5EURECiKK7vd7OIzGFiQ2xlzmNF8CSdDctsmzu5qEtNFc1rxeHkK63I0xs3L/F9I22w3qCRGdbDyHgMZJDODcNcfC3CfFzAdmPlhv3OoX3PmsAObDG+UAAAAASUVORK5CYII=",Xt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAPCAYAAAAPr1RWAAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAADESURBVDiNtZPdDYIwFEYPhgEcATdwBNwEN/gcwQ3KBOAEuoGM4AYwAhvoAyUpDeINke+t7bmnP+lNJB2BO0NK55xjJlYuTCKpBbJgrgOuzrk6kpu4WP7+slb74s7LTZxVPsYBJdBauHCT3Y8CAAFPKyepGCcsJ1+TDjhZTr4mGVBtJQfItpTf0g2kDcPXbCzyHrgAlYULm2rpWXrgChyWunCJS/3iPipogHPUdVZuIn8AhR+/GK7WzLBWbhpJuaT8X9yYDw4dXWjIxwqdAAAAAElFTkSuQmCC",jt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAAEWSURBVDiN5dIxTsMwGAXg91tFkczIBVg4AAsbiAtwjUiwxEhIXc0I008GkDJ1h4GeoEzdOzEw0I01a4TkxxIqN5KpajZ4m638n54dA/8uEi+cc6eq+jL8yDl3RfIohZDUuq7nADCKhvYBzJxzEwDXqrqMZs5E5CTZSmQGYL7WsAff+2Xbo5pCvuO9N977sMITIAAsARyqarsJjTNK7GvfsAWAqqqeROT4B2esqpMh2AJ4BnA3/DHGmFeSeymN5Mfm7plZ3WFZljtFURzkIF3XvTVN8wlER7bWXgK4yQGttWMAt2sgyakxZpckt8FEREII05wi28d7b347Ez/scwD3mV0uVPUBiO4whLAQkcccjeQis8hfyBfGVmNzPekQfAAAAABJRU5ErkJggg==",$t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAXCAYAAADgKtSgAAAAAXNSR0IArs4c6QAAAMdJREFUSEvtlcENwjAMRV/n4cYCwAJwgnUo69ATXQBYgBvzQH8VSyUKTSC04lBLlaoofnG+7bhgQCs89hqYZ5x3a/xr8+/CH27xkgFfOt+Wa/AtcARWQC78DOyAyuAlsHDwjMBbV8GvzU/5V3BJV7nv3Q2/jlxJP+jKPdpN8KA4SbIoear/mCnBqmuzJLjAM4+8dwntLt+96kmChyKeqiWYx0E7NFY54z9cmkCnH77nG02kUSaRaRlqnBSdbc9LQ/kD+hNQdO8TyrBUGFgPQxkAAAAASUVORK5CYII=",te={class:"play"},ee={class:"content"},se={class:"top"},ae={class:"songName"},le={class:"singerName"},oe={class:"middle"},ne={class:"pic"},ie=["src"],Ae={class:"lyrics"},re={class:"released"},ue={class:"published"},ce={class:"content"},ge={class:"left"},de=["src"],ve={class:"right"},me={class:"songTitle"},pe={class:"authorName"},fe={class:"playLine"},Ie={class:"tabBox"},he={class:"pattern"},Ce={key:0,src:Ot,style:{width:"48px",height:"48px","margin-top":"-12px","margin-left":"-10px"},alt:""},we={key:1,src:Wt,style:{width:"48px",height:"48px","margin-top":"-12px","margin-left":"-10px"},alt:""},Be={class:"btn"},ye={key:0,src:Zt,alt:""},Se={key:1,src:qt,alt:""},_e={key:1,class:"playList"},Ee={class:"topBox"},xe={class:"left"},Ue={class:"num"},ke={class:"content"},Re=["onClick"],Ne=["data-index"],De={class:"artist"},be={class:"right"},Ve=["onClick"],Qe={key:0,class:"empty"},Te={__name:"PlayView",setup(Pe){const rt=Mt(),o=Dt(),Q=r(0);let h=null;const y=r(!1),C=r(!1),T=r(-1),w=r(!1),d=r(null),S=r(0),B=r(0),_=r(""),E=r(!1),ut=a=>{y.value=!0,z(a)},ct=a=>{y.value&&z(a)},O=()=>{if(y.value){y.value=!1;const a=B.value/S.value*o.duration;o.seek(a)}},z=a=>{if(d.value){const e=d.value.getBoundingClientRect(),l=a.clientX-e.left;B.value=Math.max(0,Math.min(l,S.value))}};N([()=>o.currentTime,()=>o.duration,d],([a,e,l])=>{e>0&&l&&(B.value=a/e*l.offsetWidth)}),N(()=>o.isPlaying,a=>{a?H():W()});const H=()=>{h||(h=setInterval(()=>{Q.value=Q.value+1},20))},W=()=>{h&&(clearInterval(h),h=null)},gt=()=>{E.value=!0},dt=async()=>{const a=localStorage.getItem("TOKEN"),e=t.value.id?t.value.id:t.value.song_id,l=_.value,p=localStorage.getItem("USER_ID"),I={token:a,userId:p,songId:e,text:l};try{(await V.addCommunityDynamics(I)).code===200?(A("发布成功"),E.value=!1,_.value=""):A("发布失败")}catch(f){console.error("发布失败:",f),A("发布失败")}},m=v({get:()=>o.playList,set:a=>o.updatePlayList(a)}),t=v(()=>o.currentSong),x=v(()=>o.currentIndex),P=v(()=>o.currentTime),G=v(()=>o.duration),U=v(()=>o.lyrics),k=v(()=>{const a=P.value;if(Array.isArray(U.value)){for(let e=U.value.length-1;e>=0;e--)if(a>=U.value[e].time)return e}return-1}),vt=v(()=>Z(P.value)),mt=v(()=>Z(G.value)),pt=()=>{C.value=!0},ft=a=>{a.target.classList.contains("mask")&&(C.value=!1)},It=()=>{o.togglePlayPause()},ht=()=>{w.value=!0},Ct=()=>{o.clearPlayList(),C.value=!1,w.value=!1},wt=()=>{console.log("用户取消了清空播放列表的操作"),w.value=!1},Bt=a=>{T.value=a.oldIndex},yt=a=>{T.value=-1,x.value===a.oldIndex&&(o.currentIndex=a.newIndex,console.log("新选中的索引:",a.newIndex)),console.log("拖拽结束，新位置:",a.newIndex)},St=a=>{o.removeSongFromPlayList(a)},_t=a=>{a>=0&&a<m.value.length&&o.playSong(m.value[a])},Et=async()=>{if(!t.value){A("当前没有正在播放的歌曲");return}try{const a=localStorage.getItem("TOKEN"),e=t.value.id;if(t.value.isFavorite)(await V.removeFavoriteSong({token:a,songId:e})).code===200?(A("已取消收藏"),t.value.isFavorite=!1):A("取消收藏失败");else{const l={token:a,songId:e||(t.value.song_id?t.value.song_id:t.value.id),songName:t.value.name?t.value.name:t.value.title,artistId:t.value.ar?t.value.ar[0].id:t.value.artists[0].id?t.value.artists[0].id:t.value.artist_id,artistName:t.value.ar?t.value.ar[0].name:t.value.artists[0].name?t.value.artists[0].name:t.value.artist_name,artistImg:t.value.ar?t.value.ar[0].img1v1Url:t.value.artists[0].img1v1Url?t.value.artists[0].img1v1Url:t.value.artist_img,albumId:t.value.al?t.value.al.id:t.value.album.id?t.value.album.id:t.value.album_id,albumName:t.value.al?t.value.al.name:t.value.album.name?t.value.album.name:t.value.album_name,albumImg:t.value.al?t.value.al.picUrl:t.value.album.picUrl?t.value.album.picUrl:t.value.album_img,songNum:1};console.log("params的值：",l),(await V.addFavoriteSong(l)).code===200?(A("已收藏"),t.value.isFavorite=!0):A("收藏失败")}}catch(a){console.error("切换收藏状态失败:",a),A("操作失败")}},xt=async()=>{try{console.log("检查当前歌曲的收藏状态:",t.value);const a=localStorage.getItem("TOKEN"),e=t.value.id?t.value.id:t.value.song_id,l=await V.checkFavoriteStatus({token:a,songId:e});l.code===200?t.value.isFavorite=l.isFavorite:(Pt({title:"提示",message:"登录已失效，请重新登录",confirmButtonColor:"#20a162",confirmButtonText:"跳转登录",cancelButtonText:"否"}).then(()=>{rt.push("/login")}).catch(()=>{console.log("取消")}),console.log(l))}catch(a){console.error("检查收藏状态失败:",a)}},Ut=()=>{x.value>0?o.playPreviousSong():A("没有上一首了")},kt=()=>{x.value<m.value.length-1?o.playNextSong():A("没有下一首了")},Z=a=>{let e=Math.floor(a%3600/60),l=Math.floor(a%60);return e=e<10?"0"+e:e,l=l<10?"0"+l:l,`${e}:${l}`};return it(()=>{d.value&&(S.value=d.value.offsetWidth)}),N([P,G,d],([a,e,l])=>{e>0&&l&&(B.value=a/e*l.offsetWidth)}),N(k,a=>{if(a>=0){const e=document.querySelector(".lyrics ul"),l=e.querySelectorAll("li")[a];if(l){const p=l.offsetHeight,f=l.offsetTop-1*p;e.style.transform=`translateY(-${f}px)`}}}),it(async()=>{if(d.value&&(S.value=d.value.offsetWidth),k.value>=0){const a=document.querySelector(".lyrics ul"),e=a.querySelectorAll("li")[k.value];if(e){const l=e.offsetHeight,I=e.offsetTop-1*l;a.style.transform=`translateY(-${I}px)`}}t.value&&(console.log("当前播放歌曲的信息:",t.value),await xt()),o.isPlaying&&H()}),bt(()=>{W()}),(a,e)=>{var f,q,X,j,$,tt,et,st,at;const l=M("van-cell"),p=M("van-popup"),I=M("van-dialog");return g(),u("div",te,[s("div",{class:"bg",style:F({backgroundImage:`url(${(f=t.value)!=null&&f.al?t.value.al.picUrl:(q=t.value)==null?void 0:q.album_img})`})},e[5]||(e[5]=[s("div",{class:"mask"},null,-1)]),4),s("div",ee,[s("div",se,[s("i",{onClick:e[0]||(e[0]=n=>a.$router.go(-1))},e[6]||(e[6]=[s("img",{src:zt,alt:""},null,-1)])),s("p",ae,c(((X=t.value)==null?void 0:X.name)||((j=t.value)==null?void 0:j.song_name)),1),s("p",le,c(($=t.value)!=null&&$.ar?t.value.ar[0].name:t.value.artists?t.value.artists[0].name:(tt=t.value)==null?void 0:tt.artist_name),1),D(l,{onClick:L(gt,["stop"])},{default:b(()=>e[7]||(e[7]=[s("img",{src:Ht,alt:""},null,-1)])),_:1})]),s("div",oe,[s("div",ne,[s("img",{class:Y(K(o).isPlaying?"rotation":""),src:(et=t.value)!=null&&et.al?t.value.al.picUrl:(st=t.value)==null?void 0:st.album_img,style:F({transform:`rotate(${Q.value}deg)`}),alt:""},null,14,ie)])]),s("div",Ae,[s("ul",null,[(g(!0),u(Vt,null,Qt(U.value,(n,i)=>(g(),u("li",{key:i,class:Y(i===k.value?"active":"")},c(n.text?n.text:"暂无歌曲"),3))),128))])]),D(p,{show:E.value,"onUpdate:show":e[2]||(e[2]=n=>E.value=n),round:"",position:"bottom",style:{height:"36%"}},{default:b(()=>{var n,i,R,lt,ot,nt;return[s("div",re,[e[8]||(e[8]=s("p",null,"分享到社区",-1)),s("span",{onClick:L(dt,["stop"])},"发布")]),s("div",ue,[Ft(s("textarea",{"onUpdate:modelValue":e[1]||(e[1]=Rt=>_.value=Rt),placeholder:"请发表你的想法..."},null,512),[[Lt,_.value]])]),s("div",ce,[s("div",ge,[s("img",{src:(n=t.value)!=null&&n.al?t.value.al.picUrl:(i=t.value)==null?void 0:i.album_img,alt:"专辑图片"},null,8,de)]),s("div",ve,[s("div",me,c(((R=t.value)==null?void 0:R.name)||((lt=t.value)==null?void 0:lt.song_name)),1),s("div",pe,c((ot=t.value)!=null&&ot.ar?t.value.ar[0].name:t.value.artists?t.value.artists[0].name:(nt=t.value)==null?void 0:nt.artist_name),1)])])]}),_:1},8,["show"]),s("div",fe,[s("ul",{ref_key:"ul",ref:d,onMousedown:ut,onMousemove:ct,onMouseup:O,onMouseleave:O},[s("li",{style:F(`width: ${B.value}px;`)},null,4)],544),s("p",null,[s("span",null,c(vt.value),1),e[9]||(e[9]=At("/ ")),s("span",null,c(mt.value),1)])]),s("div",Ie,[s("div",he,[s("i",{onClick:Et},[(at=t.value)!=null&&at.isFavorite?(g(),u("img",Ce)):(g(),u("img",we))])]),s("div",{class:"pre"},[s("i",{onClick:Ut},e[10]||(e[10]=[s("img",{src:Gt,alt:""},null,-1)]))]),s("div",Be,[s("i",{onClick:It},[K(o).isPlaying?(g(),u("img",ye)):(g(),u("img",Se))])]),s("div",{class:"next"},[s("i",{onClick:kt},e[11]||(e[11]=[s("img",{src:Xt,alt:""},null,-1)]))]),s("div",{class:"list"},[s("i",{onClick:pt},e[12]||(e[12]=[s("img",{src:jt,alt:""},null,-1)]))])]),C.value?(g(),u("div",{key:0,onClick:ft,class:"mask"})):J("",!0),C.value?(g(),u("div",_e,[s("div",Ee,[s("div",xe,[e[13]||(e[13]=s("span",{class:"title"},"当前播放列表",-1)),s("span",Ue,"("+c(m.value.length)+")",1)]),s("div",{class:"right"},[e[15]||(e[15]=s("i",null,[s("img",{style:{width:"24px",height:"24px"},src:$t,alt:""})],-1)),s("i",{onClick:ht},e[14]||(e[14]=[s("img",{src:Tt,alt:""},null,-1)]))])]),s("div",ke,[D(K(Jt),{modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=n=>m.value=n),itemKey:"id",onStart:Bt,onEnd:yt,animation:200,handle:".drag-handle"},{item:b(({element:n,index:i})=>[s("li",{class:Y({"current-song":i===x.value,dragging:i===T.value}),onClick:R=>_t(i)},[s("div",{class:"left","data-index":i},[s("span",null,c(n.name),1),e[16]||(e[16]=At(" - ")),s("span",De,c(n.ar?n.ar[0].name:n.artists?n.artists[0].name:"未知歌手"),1)],8,Ne),s("div",be,[e[18]||(e[18]=s("i",{class:"drag-handle"},[s("img",{style:{width:"17px",height:"17px"},src:Yt,alt:""})],-1)),s("i",{onClick:L(R=>St(i),["stop"])},e[17]||(e[17]=[s("img",{style:{width:"16px",height:"12px"},src:Kt,alt:""},null,-1)]),8,Ve)])],10,Re)]),footer:b(()=>[m.value.length===0?(g(),u("div",Qe,e[19]||(e[19]=[s("p",null,"当前播放列表为空",-1)]))):J("",!0)]),_:1},8,["modelValue"])])])):J("",!0),D(I,{show:w.value,"onUpdate:show":e[4]||(e[4]=n=>w.value=n),message:"清空当前播放列表？","show-cancel-button":"","confirm-button-text":"确定","cancel-button-text":"取消",confirmButtonColor:"#20a162",onConfirm:Ct,onCancel:wt},null,8,["show"])])])}}},Ye=Nt(Te,[["__scopeId","data-v-f6c2d625"]]);export{Ye as default};
