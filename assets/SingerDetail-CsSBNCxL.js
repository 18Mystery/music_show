import{_ as j,a as H,r as _,m as E,I as O,o as c,c as u,e as h,w as N,d as s,t as r,F as R,i as P,q as z,u as Y,l as I,g as D,b as L,y as Z,n as M,s as A,h as J,f as V,C as K,z as W,J as X}from"./index-BG0--aWh.js";import{_ as ss}from"./back-D1nyqv6V.js";import{_ as ts,a as es,A as os}from"./AddToPlaylistPopup-DH_9lhBm.js";import{_ as as}from"./collect-active-BZg33xkB.js";import{_ as ns}from"./collect-uw9KXPlZ.js";const ls="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAONJREFUWEft1r0NwjAQBeBLigwDS8AQZA9LkQtXtLbcUrACDAFDACtQMEMsOCkFDUru/Egap02c9+nJfxUt/FQL51MBlAbEDXjv933fH5xzL8QEFgFCCBci2hDRva7rtuu6Ry5CCjh9wndDKAQhAsQYVyklRqxRCBGAQ9EIMQCNUAGQCDUAhcgCIBDZgB+Iq7V2O2WP+BfgbK1tZwHkLsusBnLDuSE1ABGuBqDCVQBkuBiADhcDvu4DPHb+4ziEcBuOYki4uAEewFeypmmOxpjnlI1m7Bv1Mhz78dT3BVAaWLyBN2Z3oSH0ESkdAAAAAElFTkSuQmCC",is={class:"tabList"},rs={class:"encyclopedia"},cs={class:"box"},us={class:"content"},ds={class:"content"},gs={key:0,class:"songs"},vs={class:"songlist"},ms=["onClick"],_s={class:"right"},ps=["onClick"],fs={key:0,src:as,alt:""},hs={key:1,src:ns,alt:""},ws=["onClick"],Ds={key:0,class:"albums"},As={class:"albumList"},Ss=["onClick"],Cs={class:"left"},ks=["src"],bs={class:"middle"},Fs={class:"name"},ys={class:"date"},Is={__name:"TabList",props:{singerDetail:Object,singerDesc:Object,id:String},emits:["show-popup"],setup(S,{emit:U}){const d=Y(),o=H(),p=_(0);_("");const f=_([]),w=_([]),l=S,g={songs:!1,albums:!1};let C=_(null);const x=U,i=t=>{x("show-popup",t)},n=async()=>{if(p.value===1&&!g.songs){g.songs=!0;try{const t=await I.getSingerSongs(l.id);f.value=t.hotSongs.map(a=>({...a,isFavorite:!1})),console.log("获取歌曲数据成功:",f.value),k()}catch(t){console.error("获取歌曲数据失败:",t)}}else if(p.value===2&&!g.albums){g.albums=!0;try{const t=await I.getSingerAlbums(l.id);w.value=t.hotAlbums,console.log("获取专辑数据成功:",w.value)}catch(t){console.error("获取专辑数据失败:",t)}}},k=async()=>{for(const t of f.value)try{const a=await D.checkFavoriteStatus({token:localStorage.getItem("TOKEN"),songId:t.id});a.code===200&&(t.isFavorite=a.isFavorite)}catch(a){console.error("检查收藏状态失败:",a)}},b=async t=>{var a;try{if(t.isFavorite)await D.removeFavoriteSong({token:localStorage.getItem("TOKEN"),songId:t.id});else{const m=(a=t.al)==null?void 0:a.id;console.log("专辑 ID：",m);const F=await I.getAlbumContent(m),B=F.album.size;console.log("专辑内容：",F);const y=(await I.getSingerDetail(t.ar[0].id)).artist.img1v1Url,Q={token:localStorage.getItem("TOKEN"),songId:t.id,songName:t.name,artistId:t.ar[0].id,artistName:t.ar[0].name,artistImg:y,albumId:t.al.id,albumName:t.al.name,albumImg:t.al.picUrl,songNum:B};console.log("添加收藏参数：",Q),await D.addFavoriteSong(Q)}t.isFavorite=!t.isFavorite,A(t.isFavorite?"已收藏":"已取消收藏")}catch(m){console.error("切换收藏状态失败:",m),A("操作失败")}},T=t=>{o.addToNextInplayList(t),A("已添加到播放列表"),console.log("歌曲已添加到当前播放歌曲的后面:",t)};E(()=>l.singerDesc&&l.singerDesc[1]&&l.singerDesc[1].txt?l.singerDesc[1].txt.replace(/\n/g,"<br>"):""),E(()=>l.singerDesc&&l.singerDesc[2]&&l.singerDesc[2].txt?l.singerDesc[2].txt.replace(/\n/g,"<br><br>"):"");function v(t){const a=new Date(t),m=a.getFullYear(),F=String(a.getMonth()+1).padStart(2,"0"),B=String(a.getDate()).padStart(2,"0");return`${m}-${F}-${B}`}const $=t=>{d.push({name:"albumDetail",params:{id:t}})},q=t=>{l.id!==C.value&&(o.clearPlayList(),o.addSongsToplayList(f.value),C.value=l.id),o.playSong(t)},G=E(()=>o.currentSong?o.currentSong.id:null);return O(p,t=>{t===1?(g.songs=!1,n()):t===2&&(g.albums=!1,n())}),O(f,t=>{t.length>0&&k()}),(t,a)=>{const m=L("van-tab"),F=L("van-cell"),B=L("van-tabs");return c(),u("div",is,[h(B,{active:p.value,"onUpdate:active":a[0]||(a[0]=e=>p.value=e),onChange:n,swipeable:"",color:"#20a162","line-width":"24px"},{default:N(()=>[h(m,{title:"百科"},{default:N(()=>[s("div",rs,[s("div",cs,[a[1]||(a[1]=s("h6",null,"简介",-1)),s("div",us,r(S.singerDetail.briefDesc),1)]),(c(!0),u(R,null,P(S.singerDesc,e=>(c(),u("div",{class:"box",key:e.id},[s("h6",null,r(e.ti),1),s("div",ds,r(e.txt),1)]))),128))])]),_:1}),h(m,{title:"歌曲 "+S.singerDetail.musicSize},{default:N(()=>[g.songs?(c(),u("div",gs,[s("div",vs,[s("ul",null,[(c(!0),u(R,null,P(f.value,e=>(c(),u("li",{key:e.id,class:Z({"active-song":e.id===G.value})},[s("div",{class:"left",onClick:y=>q(e)},[s("p",null,r(e.name),1),s("span",null,r(e.ar[0].name)+" - "+r(e.al.name),1)],8,ms),s("div",_s,[s("i",{onClick:M(y=>b(e),["stop"])},[e.isFavorite?(c(),u("img",fs)):(c(),u("img",hs))],8,ps),s("i",null,[s("img",{src:ts,alt:"",onClick:M(y=>T(e),["stop"])},null,8,ws)]),s("i",null,[h(F,{onClick:y=>i(e.id)},{default:N(()=>a[2]||(a[2]=[s("img",{src:es,alt:""},null,-1)])),_:2},1032,["onClick"])])])],2))),128))])])])):z("",!0)]),_:1},8,["title"]),h(m,{title:"专辑 "+S.singerDetail.albumSize},{default:N(()=>[g.albums?(c(),u("div",Ds,[s("div",As,[s("ul",null,[(c(!0),u(R,null,P(w.value,e=>(c(),u("li",{key:e.id,onClick:y=>$(e.id)},[s("div",Cs,[s("img",{src:e.picUrl,alt:""},null,8,ks)]),s("div",bs,[s("p",Fs,r(e.name),1),s("p",ys,[s("span",null,r(v(e.publishTime)),1),s("span",null,r(e.size)+"首",1)])]),a[3]||(a[3]=s("div",{class:"right"},[s("img",{src:ls,alt:""})],-1))],8,Ss))),128))])])])):z("",!0)]),_:1},8,["title"])]),_:1},8,["active"])])}}},$s=j(Is,[["__scopeId","data-v-7b0f35f2"]]),Bs={class:"singerDetail"},Ns={class:"bg"},xs={class:"picture"},Es=["src"],Ls={class:"singer"},Ts={class:"left"},Rs={class:"nameBox"},Ps={class:"name"},Us={class:"englishName"},Qs={class:"fans"},Os={class:"profession"},zs={class:"right"},Ms={class:"tabList"},Vs={__name:"SingerDetail",setup(S){const d=X().params.id;console.log("id:",d);const o=_({}),p=_({}),f=_(!1);_(localStorage.getItem("USER_ID"));const w=localStorage.getItem("TOKEN"),l=_(null),g=i=>{l.value.showPopup(i)};E(()=>f.value?"none":"block");const C=async()=>{try{const n=(await D.checkFollowStatus({token:w,followedId:d})).isFollowing,[k,b]=await Promise.all([I.getSingerDetail(d),I.getSingerDesc(d)]);let v=(await D.getFollowSingerCount({singerId:d})).count;v===0?v="暂无粉丝":v>=1e4?v=parseFloat(v/1e4).toFixed(2)+"万粉丝":v=v+"粉丝";let $=k.artist;$.fansCount=v,$.isFollowing=n,o.value=$,p.value=b.introduction,console.log("歌手详情：",o.value),console.log("歌手描述：",p.value)}catch(i){console.error("获取歌手详情失败：",i)}},x=async()=>{try{if(o.value.isFollowing)await D.removeFollow({token:w,followedId:d}),C(),o.value.isFollowing=!1,A("取消关注成功");else{const i=await D.addFollow({token:w,followedId:d,followedType:"artist",artistName:o.value.name,artistImg:o.value.img1v1Url});console.log(i),i.code===200?(o.value.isFollowing=!0,A("关注成功"),C()):A("关注失败")}}catch(i){console.error("关注操作失败：",i),A("操作失败")}};return J(()=>{C()}),(i,n)=>{var b;const k=L("van-icon");return c(),u("div",Bs,[s("div",Ns,[s("div",xs,[s("img",{src:o.value.img1v1Url,alt:""},null,8,Es)]),n[2]||(n[2]=s("div",{class:"mask"},null,-1)),s("i",{onClick:n[0]||(n[0]=T=>i.$router.go(-1)),class:"back"},n[1]||(n[1]=[s("img",{src:ss,alt:""},null,-1)]))]),s("div",Ls,[s("div",Ts,[s("div",Rs,[s("span",Ps,r(o.value.name),1),s("span",Us,r(((b=o.value.alias)==null?void 0:b[0])||""),1)]),s("div",Qs,[s("span",null,r(o.value.fansCount),1)]),s("div",Os,[s("span",null,r(o.value.imageDesc?o.value.imageDesc:""),1)])]),s("div",zs,[V(s("div",{class:"concern active",onClick:x},[h(k,{size:"13",name:"plus"}),n[3]||(n[3]=s("span",null,"关注",-1))],512),[[K,!o.value.isFollowing]]),V(s("div",{class:"concern",onClick:x},n[4]||(n[4]=[s("span",null,"已关注",-1)]),512),[[K,o.value.isFollowing]])])]),s("div",Ms,[h($s,{singerDetail:o.value,singerDesc:p.value,id:W(d),onShowPopup:g},null,8,["singerDetail","singerDesc","id"])]),h(os,{ref_key:"addToPlaylistPopup",ref:l},null,512)])}}},Ys=j(Vs,[["__scopeId","data-v-5c015da8"]]);export{Ys as default};
