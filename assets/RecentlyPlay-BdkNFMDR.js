import{_ as x,a as $,r as m,m as b,h as L,c as n,d as s,t as d,F as B,i as A,e as p,w as g,q as R,g as c,x as V,O as M,s as u,b as y,o as i,y as q,n as f,p as z}from"./index-Cshm0C-f.js";import{_ as D}from"./backSearch-D-eDlE1G.js";import{_ as E}from"./play-DwFW73Pk.js";import{_ as O}from"./collect-active-BZg33xkB.js";import{_ as U}from"./collect-uw9KXPlZ.js";import{_ as K,a as j,A as G}from"./AddToPlaylistPopup-DupXLtp7.js";const H={class:"recentlyPlay"},J={class:"header"},Q={class:"content"},W={class:"songs"},X={class:"listTop"},Y={class:"listTopLeft"},Z={style:{color:"#999"}},tt={class:"songlist"},ot=["onClick"],st={class:"right"},at=["onClick"],lt={key:0,src:O,alt:""},et={key:1,src:U,alt:""},nt=["onClick"],it={key:0,class:"loading"},rt={__name:"RecentlyPlay",setup(dt){const l=$(),r=m(localStorage.getItem("TOKEN")),e=m([]),v=m(null),k=t=>{v.value.showPopup(t)},S=async()=>{const t=await c.getRecentPlays({token:r.value});t.code===200?(e.value=t.result,console.log(e.value),C()):(V({title:"提示",message:"登录已失效，请重新登录",confirmButtonColor:"#20a162",confirmButtonText:"跳转登录",cancelButtonText:"否"}).then(()=>{M.push("/login")}).catch(()=>{console.log("取消")}),console.log(t.message))},C=async()=>{for(const t of e.value){const o=await c.checkFavoriteStatus({token:r.value,songId:t.song_id});o.code===200&&(t.isFavorite=o.isFavorite)}},P=async t=>{try{if(t.isFavorite)await c.removeFavoriteSong({token:r.value,songId:t.song_id});else{const o={token:r.value,songId:t.song_id,songName:t.song_name||t.name,artistId:t.artist_id||(t.ar?t.ar[0].id:null),artistName:t.artist_name||(t.ar?t.ar[0].name:null),artistImg:t.artist_img||(t.ar?t.ar[0].picUrl:null),albumId:t.album_id||(t.al?t.al.id:null),albumName:t.album_name||(t.al?t.al.name:null),albumImg:t.album_img||(t.al?t.al.picUrl:null),songNum:t.song_num||1};await c.addFavoriteSong(o)}t.isFavorite=!t.isFavorite,u(t.isFavorite?"已收藏":"已取消收藏")}catch(o){console.error(o),u("操作失败")}},T=t=>{if(t.length===0){u("暂无歌曲可播放");return}l.clearPlayList(),l.addSongsToplayList(t),l.playSong(t[0])},h=t=>{l.addToNextInplayList(t),l.playSong(t)},F=t=>{l.addToNextInplayList(t),u("已添加到播放列表")},I=b(()=>l.currentSong?l.currentSong.id||l.currentSong.song_id:null);return L(()=>{S()}),(t,o)=>{const N=y("van-cell"),w=y("van-loading");return i(),n("div",H,[s("div",J,[s("i",{onClick:o[0]||(o[0]=a=>t.$router.go(-1))},o[2]||(o[2]=[s("img",{src:D,alt:""},null,-1)])),o[3]||(o[3]=s("div",null,"最近播放",-1))]),s("div",Q,[s("div",W,[s("div",X,[s("div",Y,[s("i",{onClick:o[1]||(o[1]=a=>T(e.value))},o[4]||(o[4]=[s("img",{src:E,alt:""},null,-1)])),o[5]||(o[5]=s("span",null,"全部播放",-1)),s("span",Z,"("+d(e.value.length)+")",1)])]),s("div",tt,[s("ul",null,[(i(!0),n(B,null,A(e.value,a=>(i(),n("li",{key:a.song_id,class:q({"active-song":a.song_id===I.value})},[s("div",{class:"left",onClick:_=>h(a)},[s("p",null,d(a.song_name),1),s("span",null,d(a.artist_name)+" - "+d(a.album_name),1)],8,ot),s("div",st,[s("i",{onClick:f(_=>P(a),["stop"])},[a.isFavorite?(i(),n("img",lt)):(i(),n("img",et))],8,at),s("i",{onClick:f(_=>F(a),["stop"])},o[6]||(o[6]=[s("img",{src:K,alt:""},null,-1)]),8,nt),s("i",null,[p(N,{onClick:_=>k(a.song_id)},{default:g(()=>o[7]||(o[7]=[s("img",{src:j,alt:""},null,-1)])),_:2},1032,["onClick"])])])],2))),128))]),e.value==0?(i(),n("div",it,[p(w,{size:"24px"},{default:g(()=>o[8]||(o[8]=[z("加载中...")])),_:1})])):R("",!0)])])]),p(G,{ref_key:"addToPlaylistPopup",ref:v},null,512)])}}},gt=x(rt,[["__scopeId","data-v-7d98f164"]]);export{gt as default};
