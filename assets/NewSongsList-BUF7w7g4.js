import{_ as B,r as g,a as M,m as q,h as D,c,d as s,z as w,t as v,y as C,F as E,i as J,e as I,w as K,q as O,J as R,g as d,s as u,l as y,b as j,o as m,n as k,p as G}from"./index-BG0--aWh.js";import{_ as H}from"./back-D1nyqv6V.js";import{_ as Q}from"./play-DwFW73Pk.js";import{_ as W}from"./collect-active-BZg33xkB.js";import{_ as X}from"./collect-uw9KXPlZ.js";import{_ as Y,a as Z,A as tt}from"./AddToPlaylistPopup-DH_9lhBm.js";const st={class:"newSongsList"},ot={class:"bg"},at={class:"picture"},lt=["src"],et={class:"content"},it={class:"title"},nt={class:"songsList"},rt={class:"songs"},ct={class:"listTop"},dt={class:"listTopLeft"},ut={style:{"margin-left":"5px",color:"#999"}},mt={class:"songlist"},vt=["onClick"],_t={class:"left"},pt={class:"right"},gt=["onClick"],yt={key:0,src:W,alt:""},kt={key:1,src:X,alt:""},ft=["onClick"],St=["onClick"],Ft={key:0,class:"loading"},ht=50,wt={__name:"NewSongsList",setup(Ct){const N=R(),{id:_,name:f,picUrl:S}=N.params,i=g(),e=g([]),l=M(),n=g(localStorage.getItem("TOKEN")),F=g(null),L=async()=>{try{const t=await d.checkFavoritePlaylist({token:n.value,playlistId:_});console.log("是否已经点击喜欢：",t),t.code===200&&(i.value=t.isFavorite)}catch(t){console.error(t)}},b=async()=>{try{if(i.value)await d.deleteFavoritePlaylist({token:n.value,playlistId:_});else{const t={token:n.value,playlistId:_,playlistName:f,playlistImg:S};await d.addFavoritePlaylist(t)}i.value=!i.value,u(i.value?"已收藏":"已取消收藏")}catch(t){u("操作失败"),console.error(t)}},P=t=>{F.value.showPopup(t)};async function T(){try{const t=await y.getNewSongList(_,ht);t.code===200&&(e.value=t.songs,console.log("最新歌曲列表：",e.value),$())}catch(t){console.log("请求失败：",t)}}const $=async()=>{for(const t of e.value){const o=await d.checkFavoriteStatus({token:n.value,songId:t.id});o.code===200&&(t.isFavorite=o.isFavorite)}console.log("更新收藏状态：",e.value)},x=async t=>{console.log("切换收藏状态：",t);try{if(t.isFavorite)await d.removeFavoriteSong({token:n.value,songId:t.id});else{const p=(await y.getSingerDetail(t.ar?t.ar[0].id:t.artist_id)).artist.img1v1Url;console.log("歌手图片:",p);const r=(await y.getAlbumContent(t.al?t.al.id:t.album_id)).songs.length;console.log("专辑内容:",r);const h={token:n.value,songId:t.song_id||t.id,songName:t.song_name||t.name,artistId:t.artist_id||(t.ar?t.ar[0].id:null),artistName:t.artist_name||(t.ar?t.ar[0].name:null),artistImg:t.artist_img||(t.ar?t.ar[0].picUrl:null)||p,albumId:t.album_id||(t.al?t.al.id:null),albumName:t.album_name||(t.al?t.al.name:null),albumImg:t.album_img||(t.al?t.al.picUrl:null),songNum:t.song_num||r};await d.addFavoriteSong(h),console.log("收藏参数：",h)}t.isFavorite=!t.isFavorite,u(t.isFavorite?"已收藏":"已取消收藏")}catch(o){console.error(o),u("操作失败")}},A=t=>{if(t.length===0){u("暂无歌曲可播放");return}l.clearPlayList(),l.addSongsToplayList(t),l.playSong(t[0])},U=t=>{l.addToNextInplayList(t),l.playSong(t)},V=t=>{l.addToNextInplayList(t),u("已添加到播放列表")},z=q(()=>l.currentSong?l.currentSong.id||l.currentSong.id:null);return D(()=>{T(),L()}),(t,o)=>{const p=j("van-loading");return m(),c("div",st,[s("div",ot,[s("div",at,[s("img",{src:w(S),alt:"歌曲海报"},null,8,lt)]),o[4]||(o[4]=s("div",{class:"mask"},null,-1)),s("i",{onClick:o[0]||(o[0]=a=>t.$router.go(-1)),class:"back"},o[3]||(o[3]=[s("img",{src:H,alt:""},null,-1)]))]),s("div",et,[s("div",it,v(w(f)),1),s("div",{class:"like",onClick:o[1]||(o[1]=a=>b())},[s("i",{class:C(["icon-like",i.value?"icon-tLike":""])},null,2)])]),s("div",nt,[s("div",rt,[s("div",ct,[s("div",dt,[s("i",{onClick:o[2]||(o[2]=a=>A(e.value))},o[5]||(o[5]=[s("img",{src:Q,alt:""},null,-1)])),s("div",null,[o[6]||(o[6]=s("span",null,"全部播放",-1)),s("span",ut,v(e.value.length),1)])])]),s("div",mt,[s("ul",null,[(m(!0),c(E,null,J(e.value,a=>(m(),c("li",{key:a.id,onClick:r=>U(a),class:C({"active-song":a.id===z.value})},[s("div",_t,[s("p",null,v(a.name),1),s("span",null,v(a.ar[0].name)+" - "+v(a.alia[0]),1)]),s("div",pt,[s("i",{onClick:k(r=>x(a),["stop"])},[a.isFavorite?(m(),c("img",yt)):(m(),c("img",kt))],8,gt),s("i",{onClick:k(r=>V(a),["stop"])},o[7]||(o[7]=[s("img",{src:Y,alt:""},null,-1)]),8,ft),s("i",{onClick:k(r=>P(a.id),["stop"])},o[8]||(o[8]=[s("img",{src:Z,alt:""},null,-1)]),8,St)])],10,vt))),128))]),e.value.length===0?(m(),c("div",Ft,[I(p,{size:"24px"},{default:K(()=>o[9]||(o[9]=[G("加载中...")])),_:1})])):O("",!0)])]),I(tt,{ref_key:"addToPlaylistPopup",ref:F},null,512)])])}}},$t=B(wt,[["__scopeId","data-v-233b89db"]]);export{$t as default};
