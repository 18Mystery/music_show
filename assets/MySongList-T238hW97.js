import{_ as M,a as z,r as u,m as D,h as U,c as i,d as o,A as V,z as I,t as m,F as B,i as E,e as F,w as q,q as R,J,g as p,l as g,s as v,b as K,o as n,y as O,n as y,p as j}from"./index-Ci3PLr0-.js";import{_ as G}from"./back-D1nyqv6V.js";import{_ as H}from"./play-DwFW73Pk.js";import{_ as Q}from"./collect-active-BZg33xkB.js";import{_ as W}from"./collect-uw9KXPlZ.js";import{_ as X,a as Y,A as Z}from"./AddToPlaylistPopup-DVKz1sl2.js";const tt={class:"newSongsList"},st={class:"content"},ot={class:"title"},at={class:"songsList"},lt={class:"songs"},et={class:"listTop"},it={class:"listTopLeft"},nt={style:{"margin-left":"5px",color:"#999"}},rt={class:"songlist"},dt=["onClick"],ct={class:"left"},ut={class:"right"},mt=["onClick"],_t={key:0,src:Q,alt:""},pt={key:1,src:W,alt:""},vt=["onClick"],gt=["onClick"],yt={key:0,class:"loading"},St={__name:"MySongList",setup(kt){const b=J(),{playlistId:S,playlistName:k,backgroundColor:f}=b.params;console.log("路由参数：",{playlistId:S,playlistName:k,backgroundColor:f});const e=z(),_=u(localStorage.getItem("TOKEN"));u(localStorage.getItem("USER_ID"));const r=u([]),d=u([]),C=u(null),w=t=>{C.value.showPopup(t)};async function N(){try{const t=await p.getPlaylistSongs({token:_.value,playlistId:S});if(t.code===200){let s=t.result.map(l=>l.song_id);for(let l=0;l<s.length;l++){let a=await g.getSongDetail(s[l]);r.value.push(a)}d.value=r.value.map(l=>l.songs[0]),console.log("获取我的歌曲：",d.value),T()}}catch(t){console.log("请求失败：",t)}}const T=async()=>{for(const t of r.value){const s=await p.checkFavoriteStatus({token:_.value,songId:t.songs[0].id});s.code===200&&(t.songs[0].isFavorite=s.isFavorite)}console.log("更新收藏状态：",r.value)},L=async t=>{console.log(t);try{if(t.isFavorite)await p.removeFavoriteSong({token:_.value,songId:t.id});else{const l=(await g.getSingerDetail(t.ar?t.ar[0].id:t.artist_id)).artist.img1v1Url,c=(await g.getAlbumContent(t.al?t.al.id:t.album_id)).songs.length,h={token:_.value,songId:t.song_id||t.id,songName:t.song_name||t.name,artistId:t.artist_id||(t.ar?t.ar[0].id:null),artistName:t.artist_name||(t.ar?t.ar[0].name:null),artistImg:t.artist_img||(t.ar?t.ar[0].picUrl:null)||l,albumId:t.album_id||(t.al?t.al.id:null),albumName:t.album_name||(t.al?t.al.name:null),albumImg:t.album_img||(t.al?t.al.picUrl:null),songNum:t.song_num||c};console.log("收藏参数：",h),await p.addFavoriteSong(h)}t.isFavorite=!t.isFavorite,v(t.isFavorite?"已收藏":"已取消收藏")}catch(s){console.error(s),v("操作失败")}},P=t=>{if(console.log("播放全部歌曲：",t),t.length===0){v("暂无歌曲可播放");return}e.clearPlayList(),e.addSongsToplayList(t),e.playSong(t[0])},x=t=>{e.addToNextInplayList(t),e.playSong(t)},$=t=>{e.addToNextInplayList(t),v("已添加到播放列表")},A=D(()=>e.currentSong?e.currentSong.id||e.currentSong.id:null);return U(()=>{N()}),(t,s)=>{const l=K("van-loading");return n(),i("div",tt,[o("div",{class:"bg",style:V({backgroundColor:I(f)})},[s[3]||(s[3]=o("div",{class:"mask"},null,-1)),o("i",{onClick:s[0]||(s[0]=a=>t.$router.go(-1)),class:"back"},s[2]||(s[2]=[o("img",{src:G,alt:""},null,-1)]))],4),o("div",st,[o("div",ot,m(I(k)),1)]),o("div",at,[o("div",lt,[o("div",et,[o("div",it,[o("i",{onClick:s[1]||(s[1]=a=>P(d.value))},s[4]||(s[4]=[o("img",{src:H,alt:""},null,-1)])),o("div",null,[s[5]||(s[5]=o("span",null,"全部播放",-1)),o("span",nt,m(d.value.length),1)])])]),o("div",rt,[o("ul",null,[(n(!0),i(B,null,E(d.value,a=>(n(),i("li",{key:a.id,onClick:c=>x(a),class:O({"active-song":a.id===A.value})},[o("div",ct,[o("p",null,m(a.name),1),o("span",null,m(a.ar[0].name)+" - "+m(a.alia[0]),1)]),o("div",ut,[o("i",{onClick:y(c=>L(a),["stop"])},[a.isFavorite?(n(),i("img",_t)):(n(),i("img",pt))],8,mt),o("i",{onClick:y(c=>$(a),["stop"])},s[6]||(s[6]=[o("img",{src:X,alt:""},null,-1)]),8,vt),o("i",{onClick:y(c=>w(a.id),["stop"])},s[7]||(s[7]=[o("img",{src:Y,alt:""},null,-1)]),8,gt)])],10,dt))),128))]),r.value.length===0?(n(),i("div",yt,[F(l,{size:"24px"},{default:q(()=>s[8]||(s[8]=[j("加载中...")])),_:1})])):R("",!0)])]),F(Z,{ref_key:"addToPlaylistPopup",ref:C},null,512)])])}}},wt=M(St,[["__scopeId","data-v-7cfa4d43"]]);export{wt as default};
